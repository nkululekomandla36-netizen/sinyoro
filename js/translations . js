/**
 * SINYORO TRANSLATIONS SYSTEM - FIXED VERSION
 */

(function() {
    'use strict';

    const TRANSLATIONS = {
        en: {
            brandName: "Community Marketplace",
            navHome: "Home",
            navMarket: "Market",
            navMyItems: "My Items",
            navCommunity: "Community",
            navHelp: "Help",
            postItem: "Post Item",
            heroTitle: "Trade Without Internet",
            heroDescription: "Buy, sell, and barter essential goods with your nearby community. Works completely offline.",
            featureLocal: "Local Only",
            featureSecure: "Secure",
            featureEssential: "Essential Goods",
            categoriesTitle: "Available Categories",
            catFood: "Food",
            catLivestock: "Livestock",
            catTools: "Tools",
            catServices: "Services",
            catHerbs: "Herbs",
            totalItems: "Total: 18 items available",
            browseMarket: "Browse Market",
            howItWorks: "How It Works",
            checkingConnection: "Checking connection...",
            marketTitle: "ðŸ›’ Local Market",
            marketSubtitle: "Essential goods from your community",
            filterAll: "All Items",
            loadMore: "Load More",
            contactSeller: "Contact Seller",
            myItemsTitle: "ðŸ“¦ My Items",
            myItemsSubtitle: "Manage your listings and trades",
            noItemsTitle: "No Items Yet",
            noItemsDesc: "Start selling by posting your first item to the marketplace.",
            communityTitle: "ðŸ¤ Community",
            communitySubtitle: "Connect with nearby traders",
            nearbyTraders: "Nearby Traders",
            nearbySummary: "5 traders within 5km of your location",
            viewAllTraders: "View All Traders",
            trustNetwork: "Trust Network",
            trustedTraders: "Trusted Traders",
            successfulTrades: "Successful Trades",
            coverageArea: "Coverage Area",
            helpTitle: "â“ How It Works",
            helpSubtitle: "Get started in 3 simple steps",
            step1Title: "Browse Offline",
            step1Desc: "View all items without internet. The marketplace works completely offline using local network.",
            step2Title: "Connect Directly",
            step2Desc: "Contact sellers via SMS or call. No middleman, no fees. Deal directly with your community.",
            step3Title: "Trade & Barter",
            step3Desc: "Buy with cash or barter goods. Flexible trading that works for your community's needs.",
            readyToStart: "Ready to Start Trading?",
            ctaDesc: "Join hundreds of community members already trading on Sinyoro.",
            postItemNow: "Post Your First Item",
            postItemTitle: "Post New Item",
            itemTitleLabel: "Item Title",
            itemCategoryLabel: "Category",
            selectCategory: "Select category...",
            itemPriceLabel: "Price / Barter",
            itemLocationLabel: "Location",
            itemDescriptionLabel: "Description",
            itemImageLabel: "Item Image",
            sellerNameLabel: "Your Name",
            contactMethodLabel: "Contact Method",
            cancel: "Cancel",
            offlineNotice: "â„¹ï¸ This will be saved locally and shared when you connect to the network.",
            footerTagline: "Community Marketplace",
            copyright: "Â© 2024 Sinyoro. Built for rural communities.",
            languageName: "English"
        },
        sw: {
            brandName: "Soko la Jamii",
            navHome: "Nyumbani",
            navMarket: "Soko",
            navMyItems: "Vitu Vyangu",
            navCommunity: "Jamii",
            navHelp: "Msaada",
            postItem: "Weka Tangazo",
            heroTitle: "Biashara Bila Mtandao",
            heroDescription: "Nunua, uza, ubadilishe bidhaa muhimu na jamii yako ya karibu.",
            featureLocal: "Ya Karibu Tu",
            featureSecure: "Salama",
            featureEssential: "Bidhaa Muhimu",
            categoriesTitle: "Kategoria Zinazopatikana",
            catFood: "Chakula",
            catLivestock: "Mifugo",
            catTools: "Vifaa",
            catServices: "Huduma",
            catHerbs: "Mimea ya Dawa",
            totalItems: "Jumla: Vitu 18 vinapatikana",
            browseMarket: "Tazama Soko",
            howItWorks: "Jinsi Inavyofanya Kazi",
            checkingConnection: "Inakagua muunganiko...",
            marketTitle: "ðŸ›’ Soko la Kijiji",
            marketSubtitle: "Bidhaa muhimu kutoka jamii yako",
            filterAll: "Vitu Vyote",
            loadMore: "Pakia Zaidi",
            contactSeller: "Wasiliana na Mchuuzi",
            myItemsTitle: "ðŸ“¦ Vitu Vyangu",
            myItemsSubtitle: "Simamia tangazo zako",
            noItemsTitle: "Hakuna Vitu",
            noItemsDesc: "Anza kuuza kwa kuweka tangazo lako la kwanza.",
            communityTitle: "ðŸ¤ Jamii",
            communitySubtitle: "Ungana na wafanyabiashara",
            nearbyTraders: "Wafanyabiashara wa Karibu",
            nearbySummary: "Wafanyabiashara 5 katika km 5",
            viewAllTraders: "Tazama Wote",
            trustNetwork: "Mtandao wa Amani",
            trustedTraders: "Wafanyabiashara wa Kuaminika",
            successfulTrades: "Biashara za Mafanikio",
            coverageArea: "Eneo la Huduma",
            helpTitle: "â“ Jinsi Inavyofanya Kazi",
            helpSubtitle: "Anza kwa hatua 3 rahisi",
            step1Title: "Vinjari Nje ya Mtandao",
            step1Desc: "Tazama vitu vyote bila mtandao.",
            step2Title: "Ungana Moja kwa Moja",
            step2Desc: "Wasiliana na wachuuzi kupitia SMS au simu.",
            step3Title: "Biashara & Ubadilishaji",
            step3Desc: "Nunua kwa pesa au ubadilishe bidhaa.",
            readyToStart: "Tayari Kuanza Biashara?",
            ctaDesc: "Jiunge na mamia ya wanajamii.",
            postItemNow: "Weka Tangazo Lako la Kwanza",
            postItemTitle: "Weka Tangazo Jipya",
            itemTitleLabel: "Jina la Bidhaa",
            itemCategoryLabel: "Kategoria",
            selectCategory: "Chagua kategoria...",
            itemPriceLabel: "Bei / Ubadilishaji",
            itemLocationLabel: "Mahali",
            itemDescriptionLabel: "Maelezo",
            itemImageLabel: "Picha ya Bidhaa",
            sellerNameLabel: "Jina Lako",
            contactMethodLabel: "Njia ya Mawasiliano",
            cancel: "Ghairi",
            offlineNotice: "â„¹ï¸ Hii itahifadhiwa kikanda.",
            footerTagline: "Soko la Jamii",
            copyright: "Â© 2024 Sinyoro. Ilijengwa kwa jamii za vijijini.",
            languageName: "Kiswahili"
        },
        zu: {
            brandName: "Imakethe Yomphakathi",
            navHome: "Ikhaya",
            navMarket: "Imakethe",
            navMyItems: "Izinto Zami",
            navCommunity: "Umphakathi",
            navHelp: "Usizo",
            postItem: "Faka Into",
            heroTitle: "Thenga Ngaphandle Kwe-Intanethi",
            heroDescription: "Thenga, thengisa, faneleke izimpahla ezibalulekile.",
            featureLocal: "Endaweni Kuphela",
            featureSecure: "Iphephile",
            featureEssential: "Izimpahla Ezibalulekile",
            categoriesTitle: "Izigaba Ezitholakalayo",
            catFood: "Ukudla",
            catLivestock: "Izinkomo",
            catTools: "Amathuluzi",
            catServices: "Izinsiza",
            catHerbs: "Imithi Yezifo",
            totalItems: "Isamba: Izinto eziyi-18",
            browseMarket: "Phequlula Imakethe",
            howItWorks: "Ukusebenza Kwayo",
            checkingConnection: "Ihlola uxhumano...",
            marketTitle: "ðŸ›’ Imakethe Yendawo",
            marketSubtitle: "Izimpahla ezibalulekile",
            filterAll: "Zonke Izinto",
            loadMore: "Layisha Okuningi",
            contactSeller: "Xhumana Nothengisi",
            myItemsTitle: "ðŸ“¦ Izinto Zami",
            myItemsSubtitle: "Phatha izaziso zakho",
            noItemsTitle: "Azikho Izinto",
            noItemsDesc: "Qala ukuthengisa ngokufaka isaziso sakho sokuqala.",
            communityTitle: "ðŸ¤ Umphakathi",
            communitySubtitle: "Xhumana nothengisi",
            nearbyTraders: "Abathengisi Basondelene",
            nearbySummary: "Abathengisi abangu-5",
            viewAllTraders: "Buka Bonke",
            trustNetwork: "Inethiwekhi Yethemba",
            trustedTraders: "Abathengisi Abathembekile",
            successfulTrades: "Izokuhweba Eziphumelele",
            coverageArea: "Indawo Yokuviwa",
            helpTitle: "â“ Ukusebenza Kwayo",
            helpSubtitle: "Qala ngezinyathelo eziyisithupha",
            step1Title: "Phequlula Ngaphandle Kwe-Inthanethi",
            step1Desc: "Buka zonke izinto ngaphandle kwe-inthanethi.",
            step2Title: "Xhumana Ngqo",
            step2Desc: "Xhumana nothengisi nge-SMS noma ngocingo.",
            step3Title: "Thenga & Faneleka",
            step3Desc: "Thenga ngesheli noma faneleke izimpahla.",
            readyToStart: "Ulungele Ukuqala Ukuhweba?",
            ctaDesc: "Joyina amakhulu amalungu omphakathi.",
            postItemNow: "Faka Isaziso Sakho Sokuqala",
            postItemTitle: "Faka Into Entsha",
            itemTitleLabel: "Igama Lento",
            itemCategoryLabel: "Isigaba",
            selectCategory: "Khetha isigaba...",
            itemPriceLabel: "Intengo / Faneleka",
            itemLocationLabel: "Indawo",
            itemDescriptionLabel: "Incazelo",
            itemImageLabel: "Isithombe Sento",
            sellerNameLabel: "Igama Lakho",
            contactMethodLabel: "Indlela Yoxhumana",
            cancel: "Khansela",
            offlineNotice: "ðŸ’¡ Lokhu kuzogcinwa kule ndawo.",
            footerTagline: "Imakethe Yomphakathi",
            copyright: "Â© 2024 Sinyoro. Yakhelwe imiphakathi yasemakhaya.",
            languageName: "isiZulu"
        },
        sn: {
            brandName: "Musika weVanhu",
            navHome: "Kumba",
            navMarket: "Musika",
            navMyItems: "Zvinhu Zvangu",
            navCommunity: "Vanhu",
            navHelp: "Rubatsiro",
            postItem: "Isa Zvinhu",
            heroTitle: "Itengesane Pasina Internet",
            heroDescription: "Tenga, tengesa, uchange zvinhu zvinokosha.",
            featureLocal: "Yemunharaunda Chete",
            featureSecure: "Yakachengeteka",
            featureEssential: "Zvinhu Zvinokosha",
            categoriesTitle: "Zvakagadzirwa Zvinowanikwa",
            catFood: "Zvokudya",
            catLivestock: "Mhuka",
            catTools: "Zvishandiso",
            catServices: "Mabasa",
            catHerbs: "Mititi",
            totalItems: "Zvese: Zvinhu 18",
            browseMarket: "Tarisa Musika",
            howItWorks: "Maitiro EKushandisa",
            checkingConnection: "Kutarisa kuunganidzwa...",
            marketTitle: "ðŸ›’ Musika weMunharaunda",
            marketSubtitle: "Zvinhu zvinokosha",
            filterAll: "Zvinhu Zvose",
            loadMore: "Dzika Zvimwe",
            contactSeller: "Taura neMutengesi",
            myItemsTitle: "ðŸ“¦ Zvinhu Zvangu",
            myItemsSubtitle: "Tonga zvinhu zvako",
            noItemsTitle: "Hapana Zvinhu",
            noItemsDesc: "Tanga kutengesa nekusiya chinzvimbo chekutanga.",
            communityTitle: "ðŸ¤ Vanhu",
            communitySubtitle: "Batanidzana navatengesi",
            nearbyTraders: "Vatengesi Vavemunharaunda",
            nearbySummary: "Vatengesi 5 mukati mekm 5",
            viewAllTraders: "Ona Vose",
            trustNetwork: "Nzira Dokuwana",
            trustedTraders: "Vatengesi Vanogamuchirwa",
            successfulTrades: "Zvakabudirira Zvokutengesana",
            coverageArea: "Nzvimbo Inofukidzwa",
            helpTitle: "â“ Maitiro EKushandisa",
            helpSubtitle: "Tanga nenzira dziri nyore",
            step1Title: "Vhura Pasina Internet",
            step1Desc: "Ona zvinhu zvose pasina internet.",
            step2Title: "Batanidzana Nekurumidza",
            step2Desc: "Taura navatengesi kubudikidza neSMS.",
            step3Title: "Tengesana & Chengetedza",
            step3Desc: "Tenga nemari kana uchengetedze zvinhu.",
            readyToStart: "Wagadzirira Kutanga Kutengesana?",
            ctaDesc: "Pindura nevamwe zviuru.",
            postItemNow: "Isa Chinzvimbo Chekutanga",
            postItemTitle: "Isa Chinzvimbo Chitsva",
            itemTitleLabel: "Mutoro weChinzvimbo",
            itemCategoryLabel: "Chikamu",
            selectCategory: "Sarudza chikamu...",
            itemPriceLabel: "Mutengo / Kuchengetedza",
            itemLocationLabel: "Nzvimbo",
            itemDescriptionLabel: "Tsanangudzo",
            itemImageLabel: "Mufananidzo weChinzvimbo",
            sellerNameLabel: "Zita Rako",
            contactMethodLabel: "Nzira Dokuwirirana",
            cancel: "Kanzura",
            offlineNotice: "ðŸ’¡ Izvi zvichachengetwa mumusha.",
            footerTagline: "Musika weVanhu",
            copyright: "Â© 2024 Sinyoro. Yakavakwa nemisha yemuno.",
            languageName: "ChiShona"
        },
        af: {
            brandName: "Gemeenskap Markplein",
            navHome: "Tuis",
            navMarket: "Mark",
            navMyItems: "My Items",
            navCommunity: "Gemeenskap",
            navHelp: "Hulp",
            postItem: "Plaas Item",
            heroTitle: "Handel Sonder Internet",
            heroDescription: "Koop, verkoop en ruil noodsaaklike goedere.",
            featureLocal: "Slegs Plaaslik",
            featureSecure: "Veilig",
            featureEssential: "Noodsaaklike Goedere",
            categoriesTitle: "Beskikbare KategorieÃ«",
            catFood: "Kos",
            catLivestock: "Vee",
            catTools: "Gereedskap",
            catServices: "Dienste",
            catHerbs: "Kruie",
            totalItems: "Totaal: 18 items",
            browseMarket: "Blaai Mark",
            howItWorks: "Hoe Dit Werk",
            checkingConnection: "Kontroleer verbinding...",
            marketTitle: "ðŸ›’ Plaaslike Mark",
            marketSubtitle: "Noodsaaklike goedere",
            filterAll: "Alle Items",
            loadMore: "Laai Meer",
            contactSeller: "Kontak Verkoper",
            myItemsTitle: "ðŸ“¦ My Items",
            myItemsSubtitle: "Bestuur jou lyste",
            noItemsTitle: "Nog Geen Items",
            noItemsDesc: "Begin verkoop deur jou eerste item te plaas.",
            communityTitle: "ðŸ¤ Gemeenskap",
            communitySubtitle: "Koppel met handelaars",
            nearbyTraders: "NabygeleÃ« Handelaars",
            nearbySummary: "5 handelaars binne 5km",
            viewAllTraders: "Sien Almal",
            trustNetwork: "Vertrouensnetwerk",
            trustedTraders: "Betroubare Handelaars",
            successfulTrades: "Suksesvolle Ruiltransaksies",
            coverageArea: "Dekking Area",
            helpTitle: "â“ Hoe Dit Werk",
            helpSubtitle: "Begin in 3 eenvoudige stappe",
            step1Title: "Blaai Vanlyn",
            step1Desc: "Bekyk alle items sonder internet.",
            step2Title: "Koppel Direk",
            step2Desc: "Kontak verkopers via SMS of oproep.",
            step3Title: "Handel & Ruil",
            step3Desc: "Koop met kontant of ruil goedere.",
            readyToStart: "Gereed om te Begin Handel?",
            ctaDesc: "Sluit aan by honderde gemeenskapslede.",
            postItemNow: "Plaas Jou Eerste Item",
            postItemTitle: "Plaas Nuwe Item",
            itemTitleLabel: "Item Titel",
            itemCategoryLabel: "Kategorie",
            selectCategory: "Kies kategorie...",
            itemPriceLabel: "Prys / Ruil",
            itemLocationLabel: "Ligging",
            itemDescriptionLabel: "Beskrywing",
            itemImageLabel: "Item Beeld",
            sellerNameLabel: "Jou Naam",
            contactMethodLabel: "Kontak Metode",
            cancel: "Kanselleer",
            offlineNotice: "ðŸ’¡ Dit sal plaaslik gestoor word.",
            footerTagline: "Gemeenskap Markplein",
            copyright: "Â© 2024 Sinyoro. Gebou vir landelike gemeenskappe.",
            languageName: "Afrikaans"
        }
    };

    let currentLang = localStorage.getItem('sinyoro-language') || 'en';

    function init() {
        console.log('Translations initializing...');
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', setup);
        } else {
            setup();
        }
    }

    function setup() {
        setupDropdown();
        applyLanguage(currentLang);
        console.log('Translations ready');
    }

    function setupDropdown() {
        const langBtn = document.getElementById('languageBtn');
        const langDropdown = document.getElementById('langDropdown');
        
        if (!langBtn || !langDropdown) {
            console.error('Language elements not found');
            return;
        }

        // Toggle dropdown
        langBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            const isOpen = langDropdown.classList.contains('active');
            
            if (isOpen) {
                closeDropdown();
            } else {
                openDropdown();
            }
        });

        // Close on outside click
        document.addEventListener('click', function(e) {
            if (!langBtn.contains(e.target) && !langDropdown.contains(e.target)) {
                closeDropdown();
            }
        });

        // Language selection
        langDropdown.querySelectorAll('.lang-option').forEach(option => {
            option.addEventListener('click', function(e) {
                e.stopPropagation();
                const lang = this.dataset.lang;
                if (lang && lang !== currentLang) {
                    changeLanguage(lang);
                }
                closeDropdown();
            });
        });
    }

    function openDropdown() {
        const langBtn = document.getElementById('languageBtn');
        const langDropdown = document.getElementById('langDropdown');
        
        langDropdown.classList.add('active');
        langBtn.classList.add('active');
        langBtn.setAttribute('aria-expanded', 'true');
    }

    function closeDropdown() {
        const langBtn = document.getElementById('languageBtn');
        const langDropdown = document.getElementById('langDropdown');
        
        langDropdown.classList.remove('active');
        langBtn?.classList.remove('active');
        langBtn?.setAttribute('aria-expanded', 'false');
    }

    function changeLanguage(lang) {
        if (!TRANSLATIONS[lang]) return;
        
        currentLang = lang;
        localStorage.setItem('sinyoro-language', lang);
        applyLanguage(lang);
        
        // Show toast
        showToast('Language: ' + TRANSLATIONS[lang].languageName);
    }

    function applyLanguage(lang) {
        const texts = TRANSLATIONS[lang];
        if (!texts) return;

        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (texts[key]) {
                if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                    el.placeholder = texts[key];
                } else {
                    el.textContent = texts[key];
                }
            }
        });

        // Update button text
        const currentLangSpan = document.querySelector('.current-lang');
        if (currentLangSpan) {
            currentLangSpan.textContent = texts.languageName;
        }

        // Update active option
        document.querySelectorAll('.lang-option').forEach(opt => {
            opt.classList.toggle('active', opt.dataset.lang === lang);
        });

        document.documentElement.lang = lang;
    }

    function showToast(message) {
        let container = document.getElementById('toastContainer');
        if (!container) {
            container = document.createElement('div');
            container.id = 'toastContainer';
            container.style.cssText = 'position:fixed;bottom:2rem;right:2rem;z-index:99999;';
            document.body.appendChild(container);
        }

        const toast = document.createElement('div');
        toast.textContent = message;
        toast.style.cssText = 'padding:1rem 1.5rem;margin-bottom:0.5rem;background:rgba(15,23,42,0.98);color:white;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.4);border-left:4px solid #3b82f6;';
        
        container.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }

    // Expose globally
    window.TRANSLATIONS = TRANSLATIONS;
    window.setLanguage = changeLanguage;
    
    // Start
    init();
})();
