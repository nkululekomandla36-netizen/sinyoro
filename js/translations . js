/**
 * SINYORO TRANSLATIONS SYSTEM
 */

(function() {
    'use strict';

    const translations = {
        en: {
            brandName: "Community Marketplace",
            navHome: "Home",
            navMarket: "Market",
            navMyItems: "My Items",
            navCommunity: "Community",
            navHelp: "Help",
            postItem: "Post Item",
            profile: "Profile",
            heroTitle: "Trade Without Internet",
            heroDescription: "Buy, sell, and barter essential goods with your nearby community. Works completely offline.",
            featureLocal: "Local Only",
            featureSecure: "Secure",
            featureEssential: "Essential Goods",
            categoriesTitle: "Available Categories",
            catFood: "Food",
            catLivestock: "Livestock",
            catTools: "Tools",
            catServices: "Services",
            catHerbs: "Herbs",
            totalItems: "Total: 18 items available",
            browseMarket: "Browse Market",
            howItWorks: "How It Works",
            checkingConnection: "Checking connection...",
            marketTitle: "ðŸ›’ Local Market",
            marketSubtitle: "Essential goods from your community",
            filterAll: "All Items",
            loadMore: "Load More",
            contactSeller: "Contact Seller",
            trusted: "Trusted",
            newSeller: "New Seller",
            myItemsTitle: "ðŸ“¦ My Items",
            myItemsSubtitle: "Manage your listings and trades",
            noItemsTitle: "No Items Yet",
            noItemsDesc: "Start selling by posting your first item to the marketplace.",
            communityTitle: "ðŸ¤ Community",
            communitySubtitle: "Connect with nearby traders",
            nearbyTraders: "Nearby Traders",
            nearbySummary: "5 traders within 5km of your location",
            viewAllTraders: "View All Traders",
            trustNetwork: "Trust Network",
            trustedTraders: "Trusted Traders",
            successfulTrades: "Successful Trades",
            coverageArea: "Coverage Area",
            helpTitle: "â“ How It Works",
            helpSubtitle: "Get started in 3 simple steps",
            step1Title: "Browse Offline",
            step1Desc: "View all items without internet. The marketplace works completely offline using local network.",
            step2Title: "Connect Directly",
            step2Desc: "Contact sellers via SMS or call. No middleman, no fees. Deal directly with your community.",
            step3Title: "Trade & Barter",
            step3Desc: "Buy with cash or barter goods. Flexible trading that works for your community's needs.",
            readyToStart: "Ready to Start Trading?",
            ctaDesc: "Join hundreds of community members already trading on Sinyoro.",
            postItemNow: "Post Your First Item",
            postItemTitle: "Post New Item",
            itemTitleLabel: "Item Title",
            itemCategoryLabel: "Category",
            selectCategory: "Select category...",
            itemPriceLabel: "Price / Barter",
            itemLocationLabel: "Location",
            itemDescriptionLabel: "Description",
            itemImageLabel: "Item Image",
            sellerNameLabel: "Your Name",
            contactMethodLabel: "Contact Method",
            cancel: "Cancel",
            offlineNotice: "â„¹ï¸ This will be saved locally and shared when you connect to the network.",
            footerTagline: "Community Marketplace",
            copyright: "Â© 2024 Sinyoro. Built for rural communities."
        }
        // Add other languages as needed...
    };

    let currentLang = localStorage.getItem('sinyoro-language') || 'en';

    function init() {
        setupEventListeners();
        applyLanguage(currentLang);
    }

    function setupEventListeners() {
        const langBtn = document.getElementById('languageBtn');
        const langDropdown = document.getElementById('langDropdown');
        
        if (!langBtn || !langDropdown) return;

        langBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            langDropdown.classList.toggle('active');
            langBtn.classList.toggle('active');
        });

        document.addEventListener('click', (e) => {
            if (!langBtn.contains(e.target) && !langDropdown.contains(e.target)) {
                langDropdown.classList.remove('active');
                langBtn.classList.remove('active');
            }
        });

        langDropdown.querySelectorAll('.lang-option').forEach(option => {
            option.addEventListener('click', (e) => {
                e.stopPropagation();
                const lang = option.dataset.lang;
                if (lang && lang !== currentLang) {
                    changeLanguage(lang);
                }
                langDropdown.classList.remove('active');
                langBtn.classList.remove('active');
            });
        });
    }

    function changeLanguage(lang) {
        if (!translations[lang]) return;
        currentLang = lang;
        localStorage.setItem('sinyoro-language', lang);
        applyLanguage(lang);
        
        // Update active state
        document.querySelectorAll('.lang-option').forEach(opt => {
            opt.classList.toggle('active', opt.dataset.lang === lang);
        });
        
        document.querySelector('.current-lang').textContent = 
            lang === 'en' ? 'English' : 
            lang === 'sw' ? 'Kiswahili' : 
            lang === 'zu' ? 'isiZulu' : 
            lang === 'sn' ? 'ChiShona' : 'Afrikaans';
    }

    function applyLanguage(lang) {
        const texts = translations[lang];
        if (!texts) return;

        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.dataset.i18n;
            if (texts[key]) {
                if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                    if (el.placeholder) el.placeholder = texts[key];
                    else el.value = texts[key];
                } else {
                    el.textContent = texts[key];
                }
            }
        });

        document.documentElement.lang = lang;
    }

    function getText(key) {
        return translations[currentLang]?.[key] || translations['en']?.[key] || key;
    }

    // Initialize
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }

    // Expose globally
    window.SinyoroTranslations = {
        init,
        changeLanguage,
        getCurrentLanguage: () => currentLang,
        getText,
        translations
    };
    
    // Dispatch event for app.js
    document.dispatchEvent(new Event('translationsLoaded'));
})();
