/**
 * SINYORO TRANSLATIONS SYSTEM
 * Handles language switching for the marketplace
 */

(function() {
    'use strict';

    // Translation data
    const translations = {
        en: {
            brandName: "Community Marketplace",
            navHome: "Home",
            navMarket: "Market",
            navMyItems: "My Items",
            navCommunity: "Community",
            navHelp: "Help",
            postItem: "Post Item",
            profile: "Profile",
            heroTitle: "Trade Without Internet",
            heroDescription: "Buy, sell, and barter essential goods with your nearby community. Works completely offline.",
            featureLocal: "Local Only",
            featureSecure: "Secure",
            featureEssential: "Essential Goods",
            categoriesTitle: "Available Categories",
            catFood: "Food",
            catLivestock: "Livestock",
            catTools: "Tools",
            catServices: "Services",
            catHerbs: "Herbs",
            totalItems: "Total: 18 items available",
            browseMarket: "Browse Market",
            howItWorks: "How It Works",
            checkingConnection: "Checking connection...",
            offlineStatus: "Offline Mode - Working Locally",
            onlineStatus: "Online - Connected",
            marketTitle: "ðŸ›’ Local Market",
            marketSubtitle: "Essential goods from your community",
            filterAll: "All Items",
            contactSeller: "Contact Seller",
            makeOffer: "Make Offer",
            bookService: "Book Service",
            getQuote: "Get Quote",
            enrollNow: "Enroll Now",
            trusted: "Trusted",
            newSeller: "New Seller",
            toastItemPosted: "Item posted successfully!",
            toastLanguageChanged: "Language changed to English",
            toastComingSoon: "Coming soon!",
            toastOfflineMode: "You are in offline mode",
            noticeOffline: "ðŸ’¡ This will be saved locally and shared when you connect with nearby users."
        },
        sw: {
            brandName: "Soko la Jamii",
            navHome: "Nyumbani",
            navMarket: "Soko",
            navMyItems: "Vitu Vyangu",
            navCommunity: "Jamii",
            navHelp: "Msaada",
            postItem: "Weka Tangazo",
            profile: "Wasifu",
            heroTitle: "Biashara Bila Mtandao",
            heroDescription: "Nunua, uza, ubadilishe bidhaa muhimu na jamii yako ya karibu. Inafanya kazi bila mtandao.",
            featureLocal: "Ya Karibu Tu",
            featureSecure: "Salama",
            featureEssential: "Bidhaa Muhimu",
            categoriesTitle: "Kategoria Zinazopatikana",
            catFood: "Chakula",
            catLivestock: "Mifugo",
            catTools: "Vifaa",
            catServices: "Huduma",
            catHerbs: "Mimea ya Dawa",
            totalItems: "Jumla: Vitu 18 vinapatikana",
            browseMarket: "Tazama Soko",
            howItWorks: "Jinsi Inavyofanya Kazi",
            checkingConnection: "Inakagua muunganiko...",
            offlineStatus: "Hali ya Nje ya Mtandao - Inafanya Kazi Kikanda",
            onlineStatus: "Mtandaoni - Imeunganishwa",
            marketTitle: "ðŸ›’ Soko la Kijiji",
            marketSubtitle: "Bidhaa muhimu kutoka jamii yako",
            filterAll: "Vitu Vyote",
            contactSeller: "Wasiliana na Mchuuzi",
            makeOffer: "Toa Ofa",
            bookService: "Huduma ya Booking",
            getQuote: "Pata Bei",
            enrollNow: "Jiandikishe Sasa",
            trusted: "Anaaminika",
            newSeller: "Mchuuzi Mpya",
            toastItemPosted: "Tangazo limewekwa kwa mafanikio!",
            toastLanguageChanged: "Lugha imebadilishwa kuwa Kiswahili",
            toastComingSoon: "Inakuja hivi karibuni!",
            toastOfflineMode: "Upo katika hali ya nje ya mtandao",
            noticeOffline: "ðŸ’¡ Hii itahifadhiwa kikanda na kushirikiwa unapoungana na watumiaji wa karibu."
        },
        zu: {
            brandName: "Imakethe Yomphakathi",
            navHome: "Ikhaya",
            navMarket: "Imakethe",
            navMyItems: "Izinto Zami",
            navCommunity: "Umphakathi",
            navHelp: "Usizo",
            postItem: "Faka Into",
            profile: "Iphrofayela",
            heroTitle: "Thenga Ngaphandle Kwe-Intanethi",
            heroDescription: "Thenga, thengisa, faneleke izimpahla ezibalulekile nomphakathi wakho osondelene. Isebenza ngaphandle kwe-inthanethi.",
            featureLocal: "Endaweni Kuphela",
            featureSecure: "Iphephile",
            featureEssential: "Izimpahla Ezibalulekile",
            categoriesTitle: "Izigaba Ezitholakalayo",
            catFood: "Ukudla",
            catLivestock: "Izinkomo",
            catTools: "Amathuluzi",
            catServices: "Izinsiza",
            catHerbs: "Imithi Yezifo",
            totalItems: "Isamba: Izinto eziyi-18 ezitholakala",
            browseMarket: "Phequlula Imakethe",
            howItWorks: "Ukusebenza Kwayo",
            checkingConnection: "Ihlola uxhumano...",
            offlineStatus: "Imodi Engaxhunyiwe - Isebenza Endaweni",
            onlineStatus: "Kuxhunyiwe - Ixhumeke",
            marketTitle: "ðŸ›’ Imakethe Yendawo",
            marketSubtitle: "Izimpahla ezibalulekile ezivela emphakathini wakho",
            filterAll: "Zonke Izinto",
            contactSeller: "Xhumana Nothengisi",
            makeOffer: "Enza Isehlulelo",
            bookService: "Bhuka Insiza",
            getQuote: "Thola Isilinganiso",
            enrollNow: "Bhalisa Manje",
            trusted: "Thembekile",
            newSeller: "Uthengisi Omusha",
            toastItemPosted: "Into ifakiwe ngempumelelo!",
            toastLanguageChanged: "Ulimi lushintshelwe isiZulu",
            toastComingSoon: "Iyeza kungekudala!",
            toastOfflineMode: "Ukwimodi engaxhunyiwe",
            noticeOffline: "ðŸ’¡ Lokhu kuzogcinwa kule ndawo futhi kabelwe uma uxhumana nabasebenzisi basondelene."
        },
        sn: {
            brandName: "Musika weVanhu",
            navHome: "Kumba",
            navMarket: "Musika",
            navMyItems: "Zvinhu Zvangu",
            navCommunity: "Vanhu",
            navHelp: "Rubatsiro",
            postItem: "Isa Zvinhu",
            profile: "Profile",
            heroTitle: "Itengesane Pasina Internet",
            heroDescription: "Tenga, tengesa, uchange zvinhu zvinokosha nevamwe vemunharaunda yako. Inoshanda pasina internet.",
            featureLocal: "Yemunharaunda Chete",
            featureSecure: "Yakachengeteka",
            featureEssential: "Zvinhu Zvinokosha",
            categoriesTitle: "Zvakagadzirwa Zvinowanikwa",
            catFood: "Zvokudya",
            catLivestock: "Mhuka",
            catTools: "Zvishandiso",
            catServices: "Mabasa",
            catHerbs: "Mititi",
            totalItems: "Zvese: Zvinhu 18 zvinowanikwa",
            browseMarket: "Tarisa Musika",
            howItWorks: "Maitiro EKushandisa",
            checkingConnection: "Kutarisa kuunganidzwa...",
            offlineStatus: "Pasina Internet - Inoshanda Mumusha",
            onlineStatus: "Pane Internet - Yakasungwa",
            marketTitle: "ðŸ›’ Musika weMunharaunda",
            marketSubtitle: "Zvinhu zvinokosha zvemunharaunda yako",
            filterAll: "Zvinhu Zvose",
            contactSeller: "Taura neMutengesi",
            makeOffer: "Ita Kumbirwa",
            bookService: "Booka Basa",
            getQuote: "Wana Mutengo",
            enrollNow: "Nyoresa Zvino",
            trusted: "Anogamuchirwa",
            newSeller: "Mutengesi Mutsva",
            toastItemPosted: "Chinhhu chaiswa zvakanaka!",
            toastLanguageChanged: "Mutauro wachinjwa kuChiShona",
            toastComingSoon: "Chichiuya kare!",
            toastOfflineMode: "Uri mumusika pasina internet",
            noticeOffline: "ðŸ’¡ Izvi zvichachengetwa mumusha uye zvichagovana paunobatanidzana navashandisi vavemunharaunda."
        },
        af: {
            brandName: "Gemeenskap Markplein",
            navHome: "Tuis",
            navMarket: "Mark",
            navMyItems: "My Items",
            navCommunity: "Gemeenskap",
            navHelp: "Hulp",
            postItem: "Plaas Item",
            profile: "Profiel",
            heroTitle: "Handel Sonder Internet",
            heroDescription: "Koop, verkoop en ruil noodsaaklike goedere met jou nabygeleÃ« gemeenskap. Werk heeltemal vanlyn.",
            featureLocal: "Slegs Plaaslik",
            featureSecure: "Veilig",
            featureEssential: "Noodsaaklike Goedere",
            categoriesTitle: "Beskikbare KategorieÃ«",
            catFood: "Kos",
            catLivestock: "Vee",
            catTools: "Gereedskap",
            catServices: "Dienste",
            catHerbs: "Kruie",
            totalItems: "Totaal: 18 items beskikbaar",
            browseMarket: "Blaai Mark",
            howItWorks: "Hoe Dit Werk",
            checkingConnection: "Kontroleer verbinding...",
            offlineStatus: "Vanlyn Modus - Werk Plaaslik",
            onlineStatus: "Aanlyn - Gekoppel",
            marketTitle: "ðŸ›’ Plaaslike Mark",
            marketSubtitle: "Noodsaaklike goedere van jou gemeenskap",
            filterAll: "Alle Items",
            contactSeller: "Kontak Verkoper",
            makeOffer: "Maak 'n Aanbod",
            bookService: "Boek Diens",
            getQuote: "Kry Kwotasie",
            enrollNow: "Skryf Nou In",
            trusted: "Betroubaar",
            newSeller: "Nuwe Verkoper",
            toastItemPosted: "Item suksesvol geplaas!",
            toastLanguageChanged: "Taal verander na Afrikaans",
            toastComingSoon: "Kom binnekort!",
            toastOfflineMode: "Jy is in vanlyn modus",
            noticeOffline: "ðŸ’¡ Dit sal plaaslik gestoor word en gedeel word wanneer jy koppel met nabygeleÃ« gebruikers."
        }
    };

    let currentLang = localStorage.getItem('sinyoro-language') || 'en';

    function init() {
        applyLanguage(currentLang);
        setupEventListeners();
    }

    function setupEventListeners() {
        const langBtn = document.getElementById('languageBtn');
        const langDropdown = document.getElementById('langDropdown');

        if (!langBtn || !langDropdown) {
            console.error('Language selector elements not found');
            return;
        }

        // Toggle dropdown on button click
        langBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            langDropdown.classList.toggle('active');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!langBtn.contains(e.target) && !langDropdown.contains(e.target)) {
                langDropdown.classList.remove('active');
            }
        });

        // Language option clicks
        const langOptions = langDropdown.querySelectorAll('.lang-option');
        langOptions.forEach(function(option) {
            option.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                const lang = this.getAttribute('data-lang');
                if (lang && lang !== currentLang) {
                    changeLanguage(lang);
                }
                langDropdown.classList.remove('active');
            });
        });

        updateLanguageButton(currentLang);
        updateActiveOption(currentLang);
    }

    function changeLanguage(lang) {
        if (!translations[lang]) return;

        currentLang = lang;
        localStorage.setItem('sinyoro-language', lang);

        applyLanguage(lang);
        updateLanguageButton(lang);
        updateActiveOption(lang);
        showToast(translations[lang].toastLanguageChanged);
    }

    function applyLanguage(lang) {
        const texts = translations[lang];
        if (!texts) return;

        document.querySelectorAll('[data-i18n]').forEach(function(el) {
            const key = el.getAttribute('data-i18n');
            if (texts[key]) {
                if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                    if (el.hasAttribute('placeholder')) {
                        el.placeholder = texts[key];
                    } else {
                        el.value = texts[key];
                    }
                } else {
                    el.textContent = texts[key];
                }
            }
        });

        document.documentElement.lang = lang;
    }

    function updateLanguageButton(lang) {
        const langBtn = document.getElementById('languageBtn');
        if (!langBtn) return;
        const currentLangSpan = langBtn.querySelector('.current-lang');
        if (currentLangSpan) {
            const langNames = {
                en: 'English',
                sw: 'Kiswahili',
                zu: 'isiZulu',
                sn: 'ChiShona',
                af: 'Afrikaans'
            };
            currentLangSpan.textContent = langNames[lang] || 'English';
        }
    }

    function updateActiveOption(lang) {
        const langDropdown = document.getElementById('langDropdown');
        if (!langDropdown) return;

        const options = langDropdown.querySelectorAll('.lang-option');
        options.forEach(function(option) {
            option.classList.remove('active');
            if (option.getAttribute('data-lang') === lang) {
                option.classList.add('active');
            }
        });
    }

    function showToast(message) {
        let toastContainer = document.getElementById('toastContainer');
        if (!toastContainer) {
            toastContainer = document.createElement('div');
            toastContainer.id = 'toastContainer';
            toastContainer.style.cssText = 'position:fixed;bottom:2rem;right:2rem;z-index:99999;';
            document.body.appendChild(toastContainer);
        }

        const toast = document.createElement('div');
        toast.className = 'glass-card';
        toast.textContent = message;
        toast.style.cssText = 'padding:1rem 1.5rem;margin-bottom:0.5rem;background:rgba(15,23,42,0.98);color:white;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.4);';

        toastContainer.appendChild(toast);
        setTimeout(function() { toast.remove(); }, 3000);
    }

    function getText(key) {
        return translations[currentLang]?.[key] || translations['en']?.[key] || key;
    }

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }

    // Expose to window
    window.SinyoroTranslations = {
        init: init,
        changeLanguage: changeLanguage,
        getCurrentLanguage: function() { return currentLang; },
        getText: getText,
        translations: translations
    };
})();
